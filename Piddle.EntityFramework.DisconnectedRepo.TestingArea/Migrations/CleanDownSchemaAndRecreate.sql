IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[__MigrationHistory]') AND type in (N'U'))
BEGIN
    DROP TABLE [dbo].[__MigrationHistory]
END

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[FoodCourse]') AND type in (N'U'))
BEGIN
    DROP TABLE [dbo].[FoodCourse]
END

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Meal]') AND type in (N'U'))
BEGIN
    DROP TABLE [dbo].[Meal]
END

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Bill]') AND type in (N'U'))
BEGIN
    DROP TABLE [dbo].[Bill]
END

--##########################################################################################################################
--##########################################################################################################################

CREATE TABLE [dbo].[Bill] (
    [BillId] [bigint] NOT NULL IDENTITY,
    [Timestamp] rowversion NOT NULL,
    [LastUpdated] [datetime] NOT NULL,
    CONSTRAINT [PK_dbo.Bill] PRIMARY KEY ([BillId])
)
CREATE TABLE [dbo].[FoodCourse] (
    [FoodCourseId] [bigint] NOT NULL IDENTITY,
    [MealId] [bigint] NOT NULL,
    [BillId] [bigint] NOT NULL,
    [Timestamp] rowversion NOT NULL,
    [LastUpdated] [datetime] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    [Type] [int] NOT NULL,
    [Cost] [decimal](18, 2) NOT NULL,
    CONSTRAINT [PK_dbo.FoodCourse] PRIMARY KEY ([FoodCourseId])
)
CREATE INDEX [IX_MealId] ON [dbo].[FoodCourse]([MealId])
CREATE INDEX [IX_BillId] ON [dbo].[FoodCourse]([BillId])
CREATE TABLE [dbo].[Meal] (
    [MealId] [bigint] NOT NULL IDENTITY,
    [BillId] [bigint] NOT NULL,
    [Timestamp] rowversion NOT NULL,
    [LastUpdated] [datetime] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    CONSTRAINT [PK_dbo.Meal] PRIMARY KEY ([MealId])
)
CREATE INDEX [IX_BillId] ON [dbo].[Meal]([BillId])
ALTER TABLE [dbo].[FoodCourse] ADD CONSTRAINT [FK_dbo.FoodCourse_dbo.Bill_BillId] FOREIGN KEY ([BillId]) REFERENCES [dbo].[Bill] ([BillId]) ON DELETE NO ACTION
ALTER TABLE [dbo].[FoodCourse] ADD CONSTRAINT [FK_dbo.FoodCourse_dbo.Meal_MealId] FOREIGN KEY ([MealId]) REFERENCES [dbo].[Meal] ([MealId]) ON DELETE CASCADE
ALTER TABLE [dbo].[Meal] ADD CONSTRAINT [FK_dbo.Meal_dbo.Bill_BillId] FOREIGN KEY ([BillId]) REFERENCES [dbo].[Bill] ([BillId]) ON DELETE CASCADE
CREATE TABLE [dbo].[__MigrationHistory] (
    [MigrationId] [nvarchar](150) NOT NULL,
    [ContextKey] [nvarchar](300) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
)
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201512291615015_Init', N'Piddle.EntityFramework.DisconnectedRepo.TestingArea.NormalContext.NormalDbContext',  0x1F8B0800000000000400ED5BDD6EDB3614BE1FB0771074B50DAD95A4C3D005768BD46986604D53C449B1BB8296184718456A2495C618F664BBD823ED157628EA87A27E2CD9AEE30C45812292C8730E0F3F7EE79087FEF7EF7FC6AF1F22E2DC632E424627EEE1E8C07530F55910D2C5C44DE4EDF397EEEB57DF7E337E1B440FCEC7BCDD0BD50E7A523171EFA48C8F3D4FF87738426214853E6782DDCA91CF220F05CC3B3A38F8D93B3CF43088704196E38CAF122AC308A70FF03865D4C7B14C10B9600126227B0F5F66A954E73D8AB088918F27EE873008081EBD05017279C6E1C367C67F1F9D86C26794625FE2E00AC76C748D8584419C708C46EF198F10012D123F48D739212102C36798DCBA0EA29449246158C73702CF246774318BE10522D7CB1843BB5B4404CE867B5C36EF3BF283233572AFEC988BF21321593450E0E18BCC959EDD7DAD09710B5783B3B54FD5A853874F5CEDB7372121FA93EBD84A8FA784AB0E5B989791ADED99B386CC67054801CBEADF33679A1099703CA138911C11109BCC49E8FF8A97D7EC774C273421C4F4037802BE555EC0AB0F9CC598CBE515BECDBCA32C3D0F5CC7ABF6F5ECCE4557AB9FF6DB39953FFDE83AEFC1083427B8809BE1E399641CFF8229E60846FC01498939A0E53CC0D9AC789DFAAE61A50989A23857F926A4884337B5EC12CE61BD2FD5BA9BB867E10306C32ED0C33B4C17F26EE2BE749DF465FE9C19B786B55316C589C4757F59D6BE4342DEC4014A9B6A7B4FE1410DA241AF25EB3DBA0F17A91996D4294BB8C0C275AE3049BF8BBB30D61490E1EE8CB140B7D270FBA4A60946CF5974C548B1181A9B7DBA467C818159AED9EAB63378E30F30FD02C3503B0C57DF3B4DB61AB4186BB76A3273EC9514D18338ECF1EF823E6C9DFB4E22A5BDEB5049B5F7AE08454165B5BE6E19FD48F02BB135CB52FFE742206501D85606077F360FEF86867EEA10C993E15A95BE42AB22A0127EFAD34079532664E10AEC87B07C5DE70387BFB26C142669E62325EF6803EED7ACF865883F67C93EC49FF3EE10E2EFC7FB4574EBA0FEACCD6AF6CF1B6E210094527741FDA5B67D27FD9C4087D27D3FE2DD1ED17F25E92740D2EBF2DEE0BCB199EBDAB2CBED65E66B12DD4A736D46EC47744964D09C1D00CFC519418BF2CC60BBA4A71BBF41025B9177A77C07F80C30274B1053F0C28B238B062F7034C7BC0806147CF11191041E0E6AD0A8B49D49C461C916CD0FBB9B5FA090166D8FBADB9E6221007845F317F529D7936BBE3C1182F9613A799D7B1BBD86AADADFD2C0199042947955DBF6E902E6278C6146E069E2FE501B6E3F854506602B340F7AAAAA0E5D3BA85DD2534CB0C4CE89AFCFAEA648F828A8D3137835A8BE813888B90A4069001780B490CA7AD00CA91FC688F41F902562C0998D32B350687F39C531A62A60F69FCBCD2C29145A8E5CE5B7B16780B50F86ED08D00DA6D67060C3C8CCFA8622B6F5ACE2E961B565283B4569CB9C3D3D7CE681BF377A6A59407F946E15403D4C6CC5F8F000B01DB85ABEEB8396E61DCD6688B5FCB399195B07AD3652ED40A18791EAA8419CCE8B5A532D03BC11384B024596E1DB80517267581AEB1012DE321D6DA5C11AB5560595686A955607DC0A99D9D9748B38738959820CA796D23ACF638C1E3D8E6FECF91F968A15C3AC7AAD86AA61F99621359B549B3DAA5EE9EDB1DA4EAECD579D017F40C83746922160A56BDA02FB2E9C52EC1A7BF8A531D00C0B359B79C78E0ABDB0D8E1A57C275B3055595CF774753DAFC27B2D65F8F1058A63D8ED1965F9EC8D33D335F9E9F3D9F0EA73A46578BE68284217D6169A24E36881ADAFEAF820C0672117F214493447CA35D320AA35B379B985D6726D26F5D6E72E27BBBCB5FA5BF7D87E11BC21EC656A41FC2252E1333DF23260B25A447AB10211C45BCEFBA68C2411EDCE03DBA518277EA620E3757F5995F338535AE5435DDED8B3BC544B086AD358CBE4AA98E8851863853E066C6AF17B5DF0AC16D43661D58AA439635D95CE2E89794E67CA6ACBF3DAA5FC7FA0DD264F1F379B82F49B01A34BCF302B034BDFF497A02B7AA604FD666F16A80EC88FB1368D6478DD55D925E2EBEAD9D5EAF9A2C8AD656B7693427B91B559D9D938CB9456DFA4ACA54EBA892AC1B3FB305069D36C29248E46AAC168F607999210C65B36B84034BC85B9D3D501F7E8E0F0C8BA5DB93F371D3D210232F0BAE31AA5DDED5C0A9C878B50397A65FD76D3622C679FB3CBBFADCACAD2E940650DB554F52057D75237BD67B6C6BC6DFF1ED6979AC3EA25805C4BED9CE99C06F861E2FE99F63A76CE7FFBA43B3E732E392CDD63E7C0F96BC35B5B0374EB8E1BE97E22D8ADCB32EF01D07BC4FD3BC4BF8BD0C3F71B5DC04A3DBFC185AB60B30B57EBDF045A63716EE7BECC975A905F17C50E17451BEEB659A7370FD51FABF0B8EA68F9B1CB459D27543BACBB3FC15AE61345A059CDD9A8E6FF0451D7B979DF77BC0DAD9DEF4FB17CDF486F200CB656145F8BF41EBD165E2FCDB41CD1B5FEDAB047D15B9F5940223267800E9D36E822E88AD2751B7C7A97C69B347754E89AF59B0BAB4715BD49A7FE99C09ED5D7EBB3D85C9A1A5E536F90B7F2DAC2DE15D6B7E79E3A809A0F8C9F5C597DD070768E9B0155F5FA792C30ADF1FB77E07C112E4A11EAD7F0AAAE60726CD1E69CDEB29CEA2D8BF226B53DB044B04B43275C86B7C897F0D9C742A4BF46C82E42BF8DE63838A79789847D210C1947735271860A195DFAD3AB03559BC797717A997F1B43003343B5D1BCA46F92900485DD670DDBC316112A16653B61359752ED8817CB4292BEA1DE4750E6BE22845EE32826204C5CD219BAC7EBD87623F03BBC40FE323F566F17B27A22AA6E1F9F8668C151243219657F78040C07D1C3ABFF005921A16006420000 , N'6.1.3-40302')

